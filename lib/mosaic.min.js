((function(){(function(a){var b;return b=function(){function b(a,b){_.extend(this,b),this.padding==null&&(this.padding=5),this.el=a,this.num=0,this.pos={x:0,y:0},this.processed=[],this.width=this.el.width(),this.images=this.images.slice(0,5),this.count=this.images.length,this.initImages()}return b.prototype.load=function(a){var b,c;return c=this,b=new Image,b.name=a,b.src=a,b.onload=function(){var a;return c.num+=1,a={src:this.src,width:this.width,height:this.height,ratio:this.width/this.height},c.img.push(a),c.num===c.count&&c.process(a),!0},b},b.prototype.initImages=function(){var b,c,d,e,f;this.img=[],e=this.images,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(this.load(a(b).attr("src")));return f},b.prototype.render=function(){return this.el.html(this.html()),this.cb()},b.prototype.html=function(){return _.map(this.processed,function(a){return"<img src='"+a.src+"' class='mosaic' style='position: absolute; width: "+a.width+"px; height: "+a.height+"px; top: "+a.pos.y+"px; left: "+a.pos.x+"px;' />"}).join()},b.prototype.available=function(a){return a==null&&(a=0),this.width-this.pos.x-this.padding*a},b.prototype.position=function(a,b,c){return a.width=a.ratio*c,a.height=1/a.ratio*a.width,a.pos={},a.pos.x=b.x>0?b.x+this.padding*2:0,a.pos.y=b.y,this.processed.push(a),this.processed.length===this.count&&this.render(),a},b.prototype.horz=function(a,b){var c,d;return c=a.splice(0,1)[0],d=this.available(b)/c.ratio,c=this.position(c,this.pos,d),this.pos.y+=c.height+this.padding*2},b.prototype.vert=function(a,b,c){var d;return d=a.splice(0,1)[0],a.length?b==null&&(b=this.available()/(d.ratio+this.ratioVert(a))):b==null&&(b=this.available(1)/d.ratio),d=this.position(d,this.pos,b),this.pos.x+=d.width},b.prototype.process=function(){var a,b,c,d,e,f,g,h,i,j,k;c=this.img.slice(0),(c.length===5||c[0].ratio>1&&(c.length>2||c[0].ratio<c[1].ratio))&&this.horz(c,0);if(c.length===4)if(this.ratioHorz(c.slice(1))>3){d=this.available(.2)/(c[0].ratio+this.ratioVert(c.slice(1))),this.vert(c,d);for(h=0,j=c.length;h<j;h++)b=c[h],this.horz(c,2)}else a=c.splice(0,1),g=_.sortBy(c,function(a){return a.ratio}),f=g.splice(-1),e=1/(1/this.ratioHorz(g))+1/f.ratio,d=this.available()/a.ratio+e,this.vert([a],d),this.horz([f]),this.vert(g);else if(c.length===3&&this.ratioHorz(c)<1.5){d=this.available(4)/this.ratioHorz(c.slice(1));for(i=0,k=c.length;i<k;i++)b=c[i],this.vert(c,d)}else if(c.length===3&&this.ratioHorz(c)>=1.5||c.length===2)c.length===2?d=this.available(2)/(c[0].ratio+this.ratioVert(c.slice(1))):c.length===3&&(d=this.available(1)/(c[0].ratio+this.ratioVert(c.slice(1)))),this.vert(c,d);if(c.length===2)return this.horz(c,2),this.horz(c,2);if(c.length===1)return this.horz(c,2)},b.prototype.ratioVert=function(a){var b,c,d,e,f;d=0;for(e=0,f=a.length;e<f;e++)b=a[e],d+=1/b.ratio;return c=1/d},b.prototype.ratioHorz=function(a){var b,c,d,e;c=0;for(d=0,e=a.length;d<e;d++)b=a[d],c+=b.ratio;return c},b.prototype.cb=function(){if(this.callback)return this.callback()},b}(),a.fn.mosaic=function(c){return c==null&&(c={}),this.each(function(){var d,e;return e=a(this),c={},d=e.data("mosaic"),d||(c==="auto"&&(c={type:"auto"}),c.width==null&&(c.width=e.width()),c.images==null&&(c.images=e.children("img")),e.data("mosaic",d=new b(e,c))),d})}})(window.Zepto||window.jQuery)})).call(this);